---
title: "alphaTab Inline Demo Piece"
description: "使用 AlphaTab React 组件直接在文章中内联一段自定义 alphaTex 乐谱片段并提供播放器。"
pubDatetime: 2025-09-27T00:00:00+08:00
draft: false
tags:
  - alphaTab
  - music
  - react
  - astro
slug: alphatab-inline-demo-piece
---

import AlphaTabSimplePlayer from "@/components/react/AlphaTabSimplePlayer";
import rawScore from "@/data/scores/demo-piece.alphatex?raw";

> 本文演示如何不借助外部文件，直接在 MDX 中书写一段 alphaTex，并让极简播放器 `AlphaTabSimplePlayer` 自动识别与渲染。下方即为成品：

<AlphaTabSimplePlayer client:only="react" source={{ type: 'alphaTex', value: rawScore }} />


## alphaTab / alphaTex 最简用法

新增 `AlphaTabSimplePlayer` 组件（`src/components/react/AlphaTabSimplePlayer.tsx`），用于演示如何直接加载 alphaTex：

关键点：

1. 动态按需加载 `alphaTab.js` CDN；
2. 如果是 alphaTex：优先 `api.loadAlphaTex(tex)`；若运行时无该方法则采用容器 `textContent = tex` + `core.tex = true` 再实例化；
3. 其它类型直接 `api.load()`；
4. 组件仅做最小封装，方便调试 / 对比，不含高级 UI、主题、轨道控制。

示例：

```tsx
import AlphaTabSimplePlayer from '@/components/react/AlphaTabSimplePlayer';

export default function Demo() {
  const alphaTex = `\\title "Demo" . 3.3 5.3 7.3 8.3 | 3.3*4`;
  return <AlphaTabSimplePlayer source={{ type: 'alphaTex', value: alphaTex }} />;
}
```

字符串自动判别（出现典型指令或多行即视作 alphaTex）：

```tsx
<AlphaTabSimplePlayer source={'\\tempo 120\n.\n3.3 5.3 7.3 8.3'} />
```

在原 `AlphaTabApp` 中使用极简模式：

```tsx
<AlphaTabApp initialSource={'\\title "Quick" . 3.3*4'} useSimplePlayer />
```


## 说明

- 上述组件传入的是一整个多行模板字符串（通过 `?raw` 导入），组件内部会自动判定它是 alphaTex，而不是 URL 或文件。
- 你也可以加上一个显式前缀：`AT:` 来更明确语义（此例由于包含典型指令已足够判定）。
- 如果想让这段谱子在其它文章里复用，可以抽到 `src/data/score/xxx.atx` 文件（或 gp/gpx），再把 URL 或文件路径作为字符串传入。

### 使用独立 `.alphatex` 文件

本示例已经将谱面移到 `src/data/scores/demo-piece.alphatex` 并通过：

```tsx
import AlphaTabSimplePlayer from "@/components/react/AlphaTabSimplePlayer";
import rawScore from "@/data/scores/demo-piece.alphatex?raw";

<AlphaTabSimplePlayer client:only="react" source={rawScore} />
```

方式加载。关键点：

- `?raw` 让 Vite 以纯文本字符串形式导入文件内容。
- 识别逻辑里看到多行且包含 `\chord` / `\ts` 等指令即自动判定为 AlphaTex。
- 若以后你直接传入文件路径（不加 `?raw`）将被当作 URL 去 fetch —— 对本地开发并不适用，所以要保留 `?raw`。

### 何时不建议内联

- 超过 200 行的乐谱
- 需要多人协作 diff / review
- 多篇文章复用同一段乐谱

这三种情况应放入独立文件。

## FAQ

**Q: 这一段能否支持本地相对路径？** 目前代码中对裸字符串做了 URL / alphaTex 判定，还未对 `./` 或 `/scores/` 形式做本地解析，可在后续迭代中加入。

**Q: 如何添加多个段落或多首曲子切换？** 可扩展一个数组形式并在外层维护 state，传给 `AlphaTabSimplePlayer` 的 `source` 即可；若需要更复杂功能（轨道、循环、主题切换）可仍使用 `AlphaTabApp` 或其 `useSimplePlayer` 模式。

---

如果你在使用中遇到解析问题，可以在 issue 中贴出这段字符串，我会协助复现与调试。
