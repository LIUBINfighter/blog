---
title: "alphaTab.js: programmer's guitar Node.js package"
description: "ä»é›¶å¼€å§‹åœ¨ Astro åšå®¢ä¸­å¼•å…¥ alphaTab.jsï¼Œä¸ React å²›ç»„ä»¶ç»“åˆï¼Œé©±åŠ¨å‰ä»–è°±æ¸²æŸ“ä¸æš—è‰²æ¨¡å¼æ§åˆ¶ã€‚"
pubDatetime: 2025-09-25T00:00:00+08:00
draft: false
tags:
  - astro
  - react
  - alphaTab
  - music
slug: alphatab-js-programers-guitar-nodejs-package
ogImage: ../../../assets/images/2025/alphatab-js-programers-guitar-nodejs-package/og-default.svg
---

import AlphaTabApp from "@/components/react/AlphaTabApp";

> Integrating your React application into an Astro project and managing global state like dark mode is a great way to leverage Astro's performance benefits. Hereâ€™s a step-by-step guide on how you would do it.

## ğŸ¸ Live Demo: alphaTab React Player

<AlphaTabApp client:only="react" />

ä¸Šé¢çš„ React å²›ç»„ä»¶æ¼”ç¤ºäº†å®Œæ•´çš„æš—è‰²/äº®è‰²ä¸»é¢˜åˆ‡æ¢ã€ä¹è°±æ–‡ä»¶è½½å…¥ä¸ alphaTab æ¸²æŸ“æµç¨‹ã€‚ä¸‹é¢æŒ‰ç…§æ­¥éª¤æ‹†è§£æ•´ä¸ªå®ç°ã€‚

## 1. Setting Up Your Astro Project with React

é¦–å…ˆéœ€è¦ä¸€ä¸ª Astro é¡¹ç›®ä»¥åŠ React é›†æˆã€‚

### 1.1 Create an Astro project (if you don't have one)

```bash
# npm
npm create astro@latest

# yarn
yarn create astro

# pnpm
pnpm create astro@latest
```

### 1.2 Add the React integration

å¦‚æœåœ¨åˆå§‹åŒ–æ—¶é”™è¿‡äº† React é›†æˆï¼Œå¯ä»¥åœ¨é¡¹ç›®ç›®å½•ä¸‹è¡¥è·‘ä¸€æ¬¡ï¼š

```bash
npx astro add react
```

è¿™ä¸€æ­¥ä¼šå®‰è£…å¿…è¦ä¾èµ–å¹¶åœ¨ `astro.config.ts` ä¸­å†™å…¥ React é›†æˆé…ç½®ã€‚

## 2. Migrating Your React Components

å°†ç°æœ‰çš„ React ä»£ç ç§»åŠ¨åˆ° `src/components/` ç›®å½•ã€‚å¸¸è§çš„ç›®å½•ç»“æ„å¦‚ä¸‹ï¼š

```
/
â”œâ”€â”€ public/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ App.tsx
â”‚   â”‚   â””â”€â”€ AlphaTabPlayer.tsx
â”‚   â”œâ”€â”€ layouts/
â”‚   â””â”€â”€ pages/
â””â”€â”€ package.json
```

## 3. Handling Global Scripts and Styles

åŸæ¥å†™åœ¨ `index.html` çš„å…¨å±€è„šæœ¬ï¼ˆä¾‹å¦‚ alphaTab.js ä¸å…¨å±€ CSSï¼‰é€‚åˆæ¬åˆ° Astro å¸ƒå±€ä¸­ï¼Œä¾‹å¦‚ `src/layouts/Layout.astro`ï¼š

```astro
---
interface Props {
  title: string;
}

const { title } = Astro.props;
---

<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{title}</title>

    <!-- External AlphaTab Script -->
    <script
      src="https://cdn.jsdelivr.net/npm/@coderline/alphatab@latest/dist/alphaTab.js"
    ></script>

    <!-- Import Tailwind or add via CDN -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Global Styles -->
    <style is:global>
      :root {
        --at-bg-primary: #ffffff;
        --at-bg-secondary: #f7f7ff7;
        /* ... all your other light mode variables */
      }
      html.dark {
        --at-bg-primary: #111827;
        --at-bg-secondary: #1f2937;
        /* ... all your other dark mode variables */
      }
      body {
        background-color: var(--at-bg-primary);
        color: var(--at-text-primary);
        transition:
          background-color 0.3s,
          color 0.3s;
      }
      /* AlphaTab Cursors & Highlights */
      .at-cursor-bar {
        background: rgba(255, 242, 0, 0.25) !important;
      }
      html.dark .at-cursor-bar {
        background: rgba(96, 165, 250, 0.25) !important;
      }
      /* ... all other global cursor/highlight styles */
    </style>
  </head>
  <body>
    <slot />
  </body>
</html>
```

## 4. Managing Global Dark Mode State

æœ€ä½³å®è·µæ˜¯åœ¨ Astro é¡µé¢æˆ–è€…å¸ƒå±€ä¸­ç”¨ä¸€æ®µè„šæœ¬ç®¡ç†å…¨å±€çš„æš—è‰²æ¨¡å¼çŠ¶æ€ï¼Œç„¶åæŠŠè¿™ä¸ªçŠ¶æ€ä¸‹å‘ç»™ React å²›ç»„ä»¶ã€‚

æ€è·¯å¦‚ä¸‹ï¼š

- å¸ƒå±€è„šæœ¬å…ˆæ£€æŸ¥ `localStorage` ä¸­æ˜¯å¦å·²æœ‰ä¸»é¢˜åå¥½ï¼›
- è‹¥æ²¡æœ‰ï¼Œåˆ™æ ¹æ®ç³»ç»Ÿæ·±æµ…è‰²åå¥½é€‰æ‹©é»˜è®¤ä¸»é¢˜ï¼›
- æŒ‚è½½ `window.toggleTheme` ä¾› React ç»„ä»¶è°ƒç”¨ï¼›
- React å²›ç»„ä»¶è¯»å– `<html>` å…ƒç´ ä¸Šçš„ç±»åæˆ–å±æ€§å³å¯çŸ¥é“å½“å‰ä¸»é¢˜ã€‚

`src/pages/index.astro` å¯ä»¥è¿™æ ·å†™ï¼š

```astro
---
import Layout from "../layouts/Layout.astro";
import AlphaTabApp from "../components/App.tsx";
---

<Layout title="AlphaTab React Player">
  <main class="min-h-screen p-4">
    <!-- Render the React App as a client-side island -->
    <AlphaTabApp client:load />
  </main>
</Layout>

<script>
  const theme = (() => {
    if (typeof localStorage !== "undefined" && localStorage.getItem("theme")) {
      return localStorage.getItem("theme");
    }
    if (window.matchMedia("(prefers-color-scheme: dark)").matches) {
      return "dark";
    }
    return "light";
  })();

  if (theme === "dark") {
    document.documentElement.classList.add("dark");
  } else {
    document.documentElement.classList.remove("dark");
  }

  // Function to be called from React
  window.toggleTheme = () => {
    const isDark = document.documentElement.classList.toggle("dark");
    localStorage.setItem("theme", isDark ? "dark" : "light");
  };
</script>
```

## 5. Modifying the React App

æœ€åï¼Œè°ƒæ•´ React ç»„ä»¶ï¼Œä½¿å…¶è¯»å–æ¥è‡ª DOM çš„åˆå§‹ä¸»é¢˜å¹¶é€šè¿‡å…¨å±€å‡½æ•°å®Œæˆåˆ‡æ¢ï¼š

```tsx
import React, { useState, useEffect } from "react";
import AlphaTabPlayer from "./AlphaTabPlayer";
import { Sun, Moon } from "lucide-react";

// Make the global function available in TypeScript
declare global {
  interface Window {
    toggleTheme: () => void;
  }
}

const App: React.FC = () => {
  // Read initial state from the DOM, then sync with state
  const [isDarkMode, setIsDarkMode] = useState(() =>
    document.documentElement.classList.contains("dark")
  );
  const [source, setSource] = useState<string | File>(
    "https://www.alphatab.net/files/canon.gp"
  );
  const [key, setKey] = useState(Date.now());

  // Listen for changes on the <html> element
  useEffect(() => {
    const observer = new MutationObserver(() => {
      setIsDarkMode(document.documentElement.classList.contains("dark"));
    });
    observer.observe(document.documentElement, {
      attributes: true,
      attributeFilter: ["class"],
    });
    return () => observer.disconnect();
  }, []);

  // Suppress ResizeObserver error
  useEffect(() => {
    const originalError = window.console.error;
    const resizeObserverLoopErr =
      "ResizeObserver loop completed with undelivered notifications";
    window.console.error = (...args) => {
      if (
        args.length > 0 &&
        typeof args[0] === "string" &&
        args[0].startsWith(resizeObserverLoopErr)
      )
        return;
      originalError.apply(console, args);
    };
    return () => {
      window.console.error = originalError;
    };
  }, []);

  const handleFileChange = (event: React.ChangeEvent<HTMLInputElement>) => {
    if (event.target.files && event.target.files[0]) {
      setSource(event.target.files[0]);
      setKey(Date.now());
    }
  };

  return (
    <div className="bg-[--at-bg-primary] font-sans text-[--at-text-primary] transition-colors duration-300">
      <header className="mb-4 flex items-center justify-between">
        <h1 className="text-2xl font-bold">AlphaTab React Player</h1>
        <div className="flex items-center gap-4">
          <div className="flex items-center">
            <label
              htmlFor="file-upload"
              className="cursor-pointer rounded-md bg-[--at-control-bg] px-4 py-2 text-[--at-control-text] transition-colors hover:bg-[--at-control-active-bg]"
            >
              Load GP File
            </label>
            <input
              id="file-upload"
              type="file"
              className="hidden"
              onChange={handleFileChange}
              accept=".gp,.gpx,.gp3,.gp4,.gp5,.gp6,.gp7"
            />
          </div>
          {/* Call the global function defined in the Astro page */}
          <button
            onClick={() => window.toggleTheme()}
            className="rounded-full bg-[--at-bg-secondary] p-2 transition-colors hover:bg-[--at-bg-tertiary]"
          >
            {isDarkMode ? (
              <Sun className="text-yellow-400" />
            ) : (
              <Moon className="text-gray-700" />
            )}
          </button>
        </div>
      </header>
      <div className="flex justify-center">
        <AlphaTabPlayer key={key} source={source} isDarkMode={isDarkMode} />
      </div>
    </div>
  );
};

export default App;
```

è¿™æ ·å°±å®Œæˆäº† Astro + React + alphaTab.js çš„æ•´åˆã€‚ä½ å¯ä»¥ç»§ç»­æ‰©å±•æ’­æ”¾å™¨åŠŸèƒ½ï¼Œä¾‹å¦‚èŠ‚æ‹å™¨ã€é€Ÿåº¦æ§åˆ¶ã€æ’­æ”¾åˆ—è¡¨ç­‰ï¼Œæˆ–è€…æŠŠå®ƒç›´æ¥åµŒå…¥åˆ°æ›´å¤šçš„æ•™ç¨‹å‹æ–‡ç« ä¸­ã€‚
