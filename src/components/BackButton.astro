---
import IconChevronLeft from "@/assets/icons/IconChevronLeft.svg";
import LinkButton from "./LinkButton.astro";
import { SITE } from "@/config";
---

{
  SITE.showBackButton && (
    <div class="mx-auto flex w-full max-w-app items-center justify-start px-2">
      <LinkButton
        id="back-button"
        href={`${import.meta.env.BASE_URL ?? "/"}`}
        class="focus-outline mt-8 mb-2 flex hover:text-foreground/75"
      >
        <IconChevronLeft class="inline-block size-6 rtl:rotate-180" />
        <span>Go back</span>
      </LinkButton>
    </div>
  )
}

<script>
  /* Update Search Praam */
  function updateGoBackUrl() {
    const backButton: HTMLAnchorElement | null =
      document.querySelector("#back-button");

    const backUrl = sessionStorage.getItem("backUrl");
    const BASE = import.meta.env.BASE_URL ?? "/";

    if (backButton) {
      if (backUrl) {
        // If stored backUrl already starts with BASE, use it; otherwise prefix BASE
        backButton.href = backUrl.startsWith(BASE)
          ? backUrl
          : `${BASE}${backUrl.replace(/^\//, "")}`;
      } else {
        // Fallback to base
        backButton.href = BASE;
      }
    }
  }

  document.addEventListener("astro:page-load", updateGoBackUrl);
  updateGoBackUrl();
</script>
